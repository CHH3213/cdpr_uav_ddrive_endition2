- [x] - 定位偏移量：

- [x] 目标：[0,0,6]

- [x] 初始[-2.8503761141173407, -2.192284635777044, -0.10992452512346759]

- [x] 最终：[-2.296651390271867, -3.0192583434763605, 5.504310777585612]

- [x] 漂移严重，且无规律，GPS输出为设定值

- [x] - 加了50的弹性系数：会越来越快，导致崩溃
  - 加一个小车，PID控制，弹性系数20
  - 尝试了弹性系数为20，10，5的情况，最后都会发散，绳子拉力会变得很大，2千以上
  - 不设定弹性系数，加入定位模式，高度8米，不给定x,y坐标，默认以起始点x,y坐标设置，最终效果还不错，无人机绳子拉力稳定在800多，小车拉力稳定在500多，最大伸长量为8～10米左右

- [x] pid参数为0.9, 0.005, 0.01，up=1000, low= 0

- [x] - 计算出的绳子拉力理论上最大上限为11.12N，推力设置为30N的话
  - 只定姿态的话会飞走。


------

7/15

- [x] - 发布力的话题比发布无人机相关的话题快----动作剧烈，系统崩溃
  - 使用self.setpoint_raw_pub1.publish(attitude)这个话题会有时控制不住高度,越飞越高
  - 使用定高加定位定姿态，有时候三个无人机不能飞起来。或者只有其中一架或者两架飞起来
  - 三架无人机一起的话会更不稳，容易崩
  - 只定高，会比较稳定
  - 一个无人机一辆小车，质量快质量为0.25

- [x] 

- [x] - 发布话题循环多次,一次发布2个话题
  - queue_size=100
  - 无人机定高到0，0，5,初始起点在小球附近

- [x] 目标位置改为2米，当小球高0.5米以上时，小车才发布拉力

- [x] 

- [x] - 重物的绳子拉力为实际理论值
  - 弹簧系数改成5，会发散


------

7/16

- [x] 将无人机位置的获取已经改为mavros形式

- [x] 重物质量0.25

- [x] 检查插件中重物绳子拉力的输出

- [x] PID输出限定幅度,一辆无人机一辆小车

- [x] 求解最优解时，对小车拉力限定上界

- [x] 优化代码后，单个无人机可以到40hz，多个无人机最多到25hz,选择20hz

- [x] 重物的绳子拉力改为负载重量+弹力，无人机吊得会比较稳，无人机的推力为22N

  - [x] 弹性系数为1.5

- [x] 弹性系数改为5，重物的绳子拉力为计算出来的拉力，此时绳子拉得比较长，无人机推力为23N，加上4量小车拉力后最后会发散

  - [x] 弹性系数改成1.5，在一量小车、一架无人机上效果不错，

  - [x] 目标位置[0 0 1]，无人机定稿在[0,0,6]，pid参数：

    ```python
    self.control_x = PID([0.5, 0.00, 0.02], target[0], upper=30, lower=-30)  # control position x
    self.control_y = PID([0.5, 0.00, 0.02], target[1], upper=30, lower=-30)  # control position y
    self.control_z = PID([1, 0.00, 0.001], target[2], upper=30, lower= -30)  # control position z
    ```

  - [x] 目标位置改为[0,0,2],无人机丁高在[0,0,7]，效果没有前面那个好。上下振荡比较厉害。pid参数：

    ```python
    ## 2
    self.control_x = PID([0.25, 0.00, 0.01], target[0], upper=20, lower=-20)  # control position x
    self.control_y = PID([0.25, 0.00, 0.01], target[1], upper=20, lower=-20)  # control position y
    self.control_z = PID([0.1, 0.00, 0.01], target[2], upper=20, lower= -20)  # control position z
    ```

- [x] 一架无人机，多量小车，弹性系数1.1，负载绳子拉力为计算出来的弹力，平面控制得不错，但是上下跳动。使用环境：multi_drone_logger6_test.world

------

7/17

- [x] 给最小化变量限定了上界3，容易输出上界

- [x] 修改插件订阅的队列长度以及现成的timeout

  - [x] 原来的队列长度为1，现在为1000
  - [x] 原来的timeout为0.015，现在为0.01

  

------

7/18

- [x] 检查是那部分代码丢包严重
  - [x] get_dist()函数导致严重，重复求解的问题
- [x] 频率重新固定为10hz,插件队列长度改为默认1，timeout为0.1
- [x] 考虑小于5米时，下坠问题，抵消下坠的影响。
- [x] 弹性系数为5时，没有小车拉力时还不错
- [x] 绳zi拉力最大为22-18.88=3.12

------

7/19

- [x] 完成三架无人机的平衡
  - [x] 距离小于5米时，且z轴线速度往下时，施加一个指向无人机的力，无人机因为距离小于5米，不受力。
- [x] **插件的话题不同步，排在后面的没有发布过去。每发布完一个力的话题就sleep0.001秒一下**
- [x] PID的比例系数不能超过2.5,不然会发散
- [x] 小车、无人机丢包情况
  - [x] 0.001秒下：发布了500个数据，无人机在开始有一两个丢包情况。小车中间有丢包现象，logger3的丢包最多，其次是logger2，logger1次之，最后为loggger0.
  - [x] 小车0.004秒，无人机0.002秒，丢包减轻。不能再增加时间，否则无法达到10hz频率

------

7/20

- [ ] pwm与推力测试

  - [x] 18.88+1-->1567~1586

  - [x] 18.88+2-->1568~1591
  - [ ] 18.88+3-->1585~1591
  - [ ] 18.88+2.5--》1573~1588
  - [ ] 18.88+4-->1595~1608
  - [ ] 18.88+5-->1597~1611
  - [ ] 18.88+6-->1648~1677
  - [ ] 18.88+7-->1657~1717
  - [ ] 18.88+8-->1672~1736
  - [ ] 18.88+9-->1650~1777
  - [ ] 18.88+10-->1688~1810
  - [ ] 18.88+10.5--》1742～1920
  - [ ] 18.88+10.9--》1762～1825，起飞不稳
  - [ ] 负载>10时，4个电机的输出不一样，容易翻车，并且起飞不稳
  - [ ] 18.88+11--》1777～1827
  - [ ] 18.88+11.5--》1814～1861
  - [ ] 18.88+12--》1835
  - [ ] 18.88+13--》1752-1886
  - [ ] 18.88+13.5 -->勉强飞起来，但是不稳定
  - [ ] 18.88+14--》没有飞起来，略微飞起来又掉下去了

  

- [x] 推力为实际pwm波对应值

- [x] 小车插件用作一个话题

- [x] 固定力的发布频率0.002

- [x] 重物质量改为1kg

- [x] 测试无pid，但施加一个理论值[0,0,-2]

- [x] 目标点的位置7.5-sqrt(21)

- [x] PID参数

------

7/21

- [x] 目前情况

  1. 绳子模型：斜率模型

  2. 弹性系数：目前测试的是1，0.5也测试过，大于1会来回跳动的比较厉害

  3. 优化方程：模+方向的优化

  4. 优化约束：没有给优化加上限的约束

  5. PID参数：

     ```python
     self.control_x = PID(np.asarray([0.25*x_p, 0.00*x_i, 0.025*x_d])*x, target[0], upper=2.5, lower=-2.5)  # control position x
     self.control_y = PID(np.asarray([0.25*y_p, 0.00*y_i, 0.025*y_d])*y, target[1], upper=2.5, lower=-2.5)  # control position y
     self.control_z = PID(np.asarray([0.1*z_p, 0.001*z_i, 0.01*z_d])*z, target[2], upper=0, lower= -1)  # control position z
     ```

     1. 弹性系数0.5时：

     ```python
     # x_p,x_i,x_d = 1,1,1
     # y_p,y_i,y_d = 1,1,1
     # z_p,z_i,z_d = 1,1,1
     # x,y,z = 5,5,10
     ```

     2. 弹性系数1时：

     ```python
     # 弹性系数为1
     x_p,x_i,x_d = 1,1,0.5
     y_p,y_i,y_d = 1,1,0.5
     z_p,z_i,z_d = 1.2,1,0.5
     x,y,z = 5,5,10.1
     ```

- [x] 无人机体积：0.45，0.45，0.25

- [x] 小球半径：0.05，质量0.25

- [x] 3架无人机设置：

  1. **位置：drone3(0.4,0),drone2(-0.2,0.346),drone1(-0.2,-0.346)**

  2. 目标位置：7.5-sqrt(5^2-0.4^2)

- [x] 两架无人机设置:

  - [ ] 小间距，拉力分配平均

    1. **drone1(0,-0.35), drone2(0,0.35)**
    2. 目标位置：7.5-sqrt(5^2-0.35^2)

  - [ ] 大间距，拉力分配平均

    1. **drone1(0,-2).drone2(0,2)**

    2. 目标位置:7.5-sqrt(5^2-2^2)

  - [ ] 小间距，拉力分配不平均

    1. **drone1(0,-0.35),drone2(0,0.7)**
    2. 目标位置：7.5-sqrt(5^2-0.35^2)

- [x] 当油门保持中挡（在**40%-60%**的地方），飞行高度不变。超出这个范围，飞行器会不同程度的（由油门控制）上下浮动。

- [x] 重新测试PWM

| PWM1      | PWM2      | PWM3      | PWM4      | 18.88+x,重力加速度为9.8 |
| --------- | --------- | --------- | --------- | ----------------------- |
| 1562      | 1563      | 1563      | 1562      | 0                       |
| 1577      | 1577      | 1577      | 1577      | 1                       |
| 1592      | 1592      | 1592      | 1592      | 2                       |
| 1605      | 1605      | 1605      | 1605      | 3                       |
| 1618-1620 | 1618-1620 | 1618-1620 | 1618-1620 | 4                       |
| 1632      | 1632      | 1632      | 1632      | 5                       |
| 1643      | 1644      | 1644      | 1643      | 6                       |
| 1658      | 1658      | 1658      | 1658      | 7                       |
| 1670      | 1670      | 1670      | 1670      | 8                       |
| 1683      | 1683      | 1683      | 1683      | 9                       |
| 1698      | 1700      | 1700      | 1698      | 10                      |
| 1714      | 1714      | 1714      | 1714      | 11                      |
| 1720      | 1720      | 1720      | 1720      | 12                      |
| 1733      | 1733      | 1733      | 1733      | 13                      |
|           |           |           |           |                         |

------

7/22

- [x] 绳子弹力模型修改

  - [x] 会发散崩溃

- [x] 数据保存代码

- [ ] PID参数

  - [x] 2dBA

  ```python
  x_p,x_i,x_d = 1,1,0.5
  y_p,y_i,y_d = 1,1,0.5
  z_p,z_i,z_d = 1.1,1,0.5
  x,y,z = 5,5,10.1
  self.control_x = PID(np.asarray([0.25*x_p, 0.00*x_i, 0.025*x_d])*x, target[0], upper=25, lower=-25)  # control position x
  self.control_y = PID(np.asarray([0.25*y_p, 0.00*y_i, 0.025*y_d])*y, target[1], upper=25, lower=-25)  # control position y
  self.control_z = PID(np.asarray([0.11*z_p, 0.00*z_i, 0.0038*z_d])*z, target[2], upper=10, lower= -10)  # control position z
  ```


------

7/23

小车目标合力[0 0 -1]

- [x] 3架无人机设置：

  1. **位置：drone3(0.4,0),drone2(-0.2,0.346),drone1(-0.2,-0.346)**

  2. 目标位置：0 0 3.6
- [x] 两架无人机设置:

  - [ ] 小间距，拉力分配平均

    1. **drone1(0,-0.35), drone2(0,0.35)**
    2. 目标位置：3

  - [ ] 大间距，拉力分配平均

    1. **drone1(0,-3).drone2(0,3)**

    2. 目标位置:3.825

  - [ ] 小间距，拉力分配不平均

    1. **drone1(0,-0.25),drone2(0,0.45)**
    2. 目标位置：3
- [x] 环境设置

------

7/24

- [x] 做实验，保留好的结果
